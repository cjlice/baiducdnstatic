/*! JRoll v1.0.10 ~ (c) 2015 Author:jlong, Email:jlong@chjtx.com Website:http://www.chjtx.com/JRoll/ */
!function(a,b,c){"use strict";function l(a,b){for(var c=0,d=0;a;)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent,a===b&&(a=null);return{left:c,top:d}}function m(c,d){var f,e=this;if(e.wrapper="string"==typeof c?b.querySelector(c):c,e.scroller=d&&d.scroller?"string"==typeof d.scroller?b.querySelector(d.scroller):d.scroller:e.wrapper.children[0],e.scroller.jroll)return e.scroller.jroll.refresh(),e.scroller.jroll;e.scroller.jroll=e,e.wrapperOffset=l(e.wrapper,b.body),e.options={scroll:!0,scrollX:!0,scrollY:!0,scrollFree:!1,zoom:!1,zoomMin:1,zoomMax:4,bounce:!1,scrollBarX:!1,scrollBarY:!1,scrollBarFade:!1,stopPropagation:!1,preventDefault:!0,momentum:!0,autoStyle:!0,g:8e-4,adjustTop:190};for(f in d)"scroller"!==f&&(e.options[f]=d[f]);e.options.autoStyle&&("static"===a.getComputedStyle(e.wrapper).position&&(e.wrapper.style.position="relative"),e.wrapper.style.overflow="hidden",e.scroller.style.minHeight="100%"),e.x=0,e.y=0,e.status=null,e.instance=null,e.scrollBarX=null,e.scrollBarY=null,e._scroll={startX:0,startY:0,endX:0,endY:0,lockX:!1,lockY:!1},e._zoom={spacing:0,scale:1,startScale:1},e._event={scrollStart:[],scroll:[],scrollEnd:[],zoomStart:[],zoom:[],zoomEnd:[]},e._event.scrollStart.push(e._defaultScrollStart),e._event.scroll.push(e._defaultScroll),e._event.scrollEnd.push(e._defaultScrollEnd),e.refresh(),h?(e.scroller.addEventListener("touchstart",e._touch.bind(e,e.scroller),!1),b.addEventListener("touchmove",e._touch.bind(e,e.scroller),!1),b.addEventListener("touchend",e._touch.bind(e,e.scroller),!1),b.addEventListener("touchcancel",e._touch.bind(e,e.scroller),!1)):(e.scroller.addEventListener("mousedown",e._touch.bind(e,e.scroller),!1),b.addEventListener("mousemove",e._touch.bind(e,e.scroller),!1),b.addEventListener("mouseup",e._touch.bind(e,e.scroller),!1),e.scroller.addEventListener("mousewheel",e._wheel.bind(e),!1)),i&&(e.scroller.addEventListener("focusin",e._focusin.bind(e),!1),e.scroller.addEventListener("focusout",e._focusout.bind(e),!1),a.addEventListener("resize",e._resize.bind(e),!1))}var d=a.requestAnimationFrame||a.webkitRequestAnimationFrame||function(a){setTimeout(a,16)},e=b.createElement("div").style,f="transform"in e?"transform":"-webkit-transform",g="transitionDuration"in e?"transition-duration":"-webkit-transition-duration",h=/mobile|phone|android|pad/.test(navigator.userAgent.toLowerCase()),i=/Android/.test(navigator.userAgent),j=null,k=function(a){var c,b=a.getElementsByTagName("script");for(c=b.length-1;c>-1;c--)if("normal"===b[c].getAttribute("jroll-import"))return!0;return!1}(b);m.prototype={refresh:function(){var b,a=this;return a.wrapperWidth=a.wrapper.clientWidth,a.wrapperHeight=a.wrapper.clientHeight,a.scrollerWidth=c.round(a.scroller.offsetWidth*a._zoom.scale),a.scrollerHeight=c.round(a.scroller.offsetHeight*a._zoom.scale),a.maxScrollX=a.wrapperWidth-a.scrollerWidth,a.maxScrollY=a.wrapperHeight-a.scrollerHeight,a.maxScrollX>=0?(a.options.bounce||(a._scroll.lockX=!0),a.maxScrollX=0):a._scroll.lockX=!1,a.maxScrollY>=0?(a.options.bounce||(a._scroll.lockY=!0),a.maxScrollY=0):a._scroll.lockY=!1,a._scroll.endX=a.x,a._scroll.endY=a.y,a.options.scrollBarX?(a.scrollBarX||(b=a._createScrollBar("jroll-xbar","jroll-xbtn",!1),a.scrollBarX=b[0],a.scrollBtnX=b[1]),a.scrollBarScaleX=a.wrapper.clientWidth/a.scrollerWidth,a.scrollBtnX.style.width=c.round(a.scrollBarX.clientWidth*a.scrollBarScaleX)+"px"):a.scrollBarX&&(a.wrapper.removeChild(a.scrollBarX),a.scrollBarX=null),a.options.scrollBarY?(a.scrollBarY||(b=a._createScrollBar("jroll-ybar","jroll-ybtn",!0),a.scrollBarY=b[0],a.scrollBtnY=b[1]),a.scrollBarScaleY=a.wrapper.clientHeight/a.scrollerHeight,a.scrollBtnY.style.height=c.round(a.scrollBarY.clientHeight*a.scrollBarScaleY)+"px"):a.scrollBarY&&(a.wrapper.removeChild(a.scrollBarY),a.scrollBarY=null),a},_focusin:function(a){var b=this;j=a.target,setTimeout(function(){var c,d;b.refresh(),c=l(a.target,b.wrapper),d=c.top+b.y,d>b.options.adjustTop&&b.scrollTo(b.x,b.y-d+b.options.adjustTop,400)},600)},_focusout:function(){var b=this;setTimeout(function(){b.refresh(),b.scrollTo(b.x,b.y,400)},600)},_resize:function(){var a=this,b=a.maxScrollX,c=a.maxScrollY;setTimeout(function(){a.refresh(),(b!==a.maxScrollX||c!==a.maxScrollY)&&((b<a.maxScrollX||c<a.maxScrollY)&&j&&j.blur(),a.scrollTo(a.x,a.y,400))},600)},_scrollTo:function(a,b){this.scroller.style[f]="translate("+a+"px, "+b+"px) translateZ(0) scale("+this._zoom.scale+")"},scrollTo:function(a,b,c){var d=this;return d._scroll.endX=d.x=a>=0?0:a<=d.maxScrollX?d.maxScrollX:a,d._scroll.endY=d.y=b>=0?0:b<=d.maxScrollY?d.maxScrollY:b,c&&(d.scroller.style[g]=c+"ms",setTimeout(function(){d.scroller.style[g]="0ms"},c)),d._scrollTo(d.x,d.y),d._runScrollBar(),d},_wheel:function(a){var b=this;b.scrollTo(b.x,b._compute(b.y+a.wheelDelta,b.maxScrollY)),b._runScrollBar()},on:function(a,b){var c=this;switch(a){case"scrollStart":c._event.scrollStart.push(b);break;case"scroll":c._event.scroll.push(b);break;case"scrollEnd":c._event.scrollEnd.push(b);break;case"zoomStart":c._event.zoomStart.push(b);break;case"zoom":c._event.zoom.push(b);break;case"zoomEnd":c._event.zoomEnd.push(b)}},_execEvent:function(a,b){var d,e,c=this;for(d=0,e=c._event[a].length;e>d;d++)c._event[a][d].call(c,b)},_createScrollBar:function(a,c,d){var e=this,f=b.createElement("div"),g=b.createElement("div");return f.className=a,g.className=c,(this.options.scrollBarX===!0||this.options.scrollBarY===!0)&&(d?(f.style.cssText="background:#999;position:absolute;top:0;right:0;bottom:0;width:3px;height:100%;overflow:hidden;",g.style.cssText="background:#000;position:absolute;top:0;left:0;right:0;"):(f.style.cssText="background:#999;position:absolute;left:0;bottom:0;right:0;height:3px;width:100%;overflow:hidden;",g.style.cssText="background:#000;height:100%;position:absolute;left:0;top:0;bottom:0;")),e.options.scrollBarFade&&(f.style.opacity=0),f.appendChild(g),e.wrapper.appendChild(f),[f,g]},_runScrollBar:function(){var b,d,a=this;!a._scroll.lockX&&a.scrollBtnX&&(b=c.round(-a.x*a.scrollBarScaleX),a._scrollTo.call({scroller:a.scrollBtnX,_zoom:{scale:1}},b,0)),!a._scroll.lockY&&a.scrollBtnY&&(d=c.round(-a.y*a.scrollBarScaleY),a._scrollTo.call({scroller:a.scrollBtnY,_zoom:{scale:1}},0,d))},_bounceFun:function(a,b,c,e){var g,f=this;return b-=16,b>0?(g=c+a*b*b,e?(f._scroll.endY=f.y=g,f._scrollTo(f.x,g)):(f._scroll.endX=f.x=g,f._scrollTo(g,f.y)),f._execEvent("scroll"),d(f._bounceFun.bind(f,a,b,c,e)),void 0):(e?(f._scroll.endY=f.y=c,f._scrollTo(f.x,c)):(f._scroll.endX=f.x=c,f._scrollTo(c,f.y)),f._execEvent("scrollEnd"),void 0)},_defaultScrollStart:function(){var b=this;b.options.scrollBarFade&&(b.scrollBarX&&(b.scrollBarX.style.opacity=1),b.scrollBarY&&(b.scrollBarY.style.opacity=1))},_defaultScroll:function(a){var b=this;b._runScrollBar(),a&&!i&&a[0].pageY<12&&(b.status="end",b.scrollTo(b.x,b.y,400))},_bounceEvent:function(){var d,a=this,e=200,b=a.x>=0?0:a.x<=a.maxScrollX?a.maxScrollX:a.x,c=a.y>=0?0:a.y<=a.maxScrollY?a.maxScrollY:a.y;b!==a.x&&(d=(a.x-b)/4e4,a._bounceFun(d,e,b,!1)),c!==a.y&&(d=(a.y-c)/4e4,a._bounceFun(d,e,c,!0)),b===a.x&&c===a.y&&a._execEvent("scrollEnd")},_defaultScrollEnd:function(){var a=this;a._runScrollBar(),a.options.scrollBarFade&&(a.scrollBarX&&a._fade(a.scrollBarX,2e3),a.scrollBarY&&a._fade(a.scrollBarY,2e3))},_fade:function(a,b){var c=this;("end"===c.status||"start"===c.status)&&b>0&&(b-=25,0===b%100&&(a.style.opacity=b/1e3),d(c._fade.bind(c,a,b)))},_endAction:function(a){var b=this;b._scroll.lockX=!1,b._scroll.lockY=!1,a||(b.instance=null),b.status=a||"end",b.options.bounce?b._bounceEvent():b._execEvent("scrollEnd")},_step:function(){var b,e,a=this;if("scroll"!==a.status)return"start"!==a.status?a._endAction():a._endAction("start"),void 0;if(a.options.scrollFree&&a.timeX<=0&&a.timeY<=0)return a._endAction(),void 0;if(!a._scroll.lockX){if(a.timeX<=0&&!a.options.scrollFree)return a._endAction(),void 0;a.speedX=a.timeX<=0&&a.options.scrollFree?0:+(a.directionX+a.timeX*a.options.g),a.x=a._scroll.endX=c.round(a._scroll.endX+16*a.speedX),b=a._compute(a.x,a.maxScrollX),b!==a.x&&(a.x=a._scroll.endX=a.options.bounce&&a.x-b>10?parseInt(a.directionX+25,10)+b:b,a.options.scrollFree||(a.status="end")),a.timeX=a.timeX-16}if(!a._scroll.lockY){if(a.timeY<=0&&!a.options.scrollFree)return a._endAction(),void 0;a.speedY=a.timeY<=0&&a.options.scrollFree?0:+(a.directionY+a.timeY*a.options.g),a.y=a._scroll.endY=c.round(a._scroll.endY+16*a.speedY),e=a._compute(a.y,a.maxScrollY),e!==a.y&&(a.y=a._scroll.endY=a.options.bounce&&a.y-e>10?parseInt(a.directionY+25,10)+e:e,a.options.scrollFree||(a.status="end")),a.timeY=a.timeY-16}a._scrollTo(a.x,a.y),a._execEvent("scroll"),d(a._step.bind(a))},_compute:function(a,b){var d=this;return a>0?d.options.bounce&&a>10?c.round(a/5):0:b>a?d.options.bounce&&b-10>a?c.round(b+(a-b)/5):b:a},_touch:function(a,b){var h,i,l,j,k,m,n,e=this,f=b.type,g=b.touches||[b];switch(e.options.stopPropagation&&b.stopPropagation(),f){case"touchstart":case"mousedown":e.status="start",e.instance=a,1===g.length?(e.startTime=Date.now(),e.startPositionX=e._scroll.startX=g[0].pageX,e.startPositionY=e._scroll.startY=g[0].pageY):(e.scroller.style["-webkit-transform-origin"]="0 0",h=c.abs(g[0].pageX-g[1].pageX),i=c.abs(g[0].pageY-g[1].pageY),e._zoom.spacing=c.sqrt(h*h+i*i),e._zoom.startScale=e._zoom.scale,e.originX=c.abs(g[0].pageX+g[1].pageX)/2-e.wrapperOffset.left-e.x,e.originY=c.abs(g[0].pageY+g[1].pageY)/2-e.wrapperOffset.top-e.y);break;case"touchmove":case"mousemove":if(!e.instance)return;if(e.options.preventDefault&&b.preventDefault(),"start"===e.status)return 1===g.length&&e.options.scroll?(e.options.scrollFree||e._scroll.lockX||e._scroll.lockY||(c.abs(g[0].pageX-e._scroll.startX)>c.abs(g[0].pageY-e._scroll.startY)?e._scroll.lockY=!0:e._scroll.lockX=!0),e.options.scrollX||(e._scroll.lockX=!0),e.options.scrollY||(e._scroll.lockY=!0),e._execEvent("scrollStart",g),e.status="scroll"):e.options.zoom&&(e._execEvent("zoomStart",g),e.status="zoom"),void 0;if("scroll"===e.status)return e._scroll.lockX||(e.x=g[0].pageX-e._scroll.startX+e._scroll.endX,e.x=e._compute(e.x,e.maxScrollX)),e._scroll.lockY||(e.y=g[0].pageY-e._scroll.startY+e._scroll.endY,e.y=e._compute(e.y,e.maxScrollY)),e._scrollTo(e.x,e.y),e._execEvent("scroll",g),Date.now()-e.startTime>200&&(e.startTime=Date.now()-50,e.startPositionX=g[0].pageX,e.startPositionY=g[0].pageY),e._scroll.lockX||(e.distanceX=g[0].pageX-e.startPositionX),e._scroll.lockY||(e.distanceY=g[0].pageY-e.startPositionY),void 0;if("zoom"===e.status)return h=c.abs(g[0].pageX-g[1].pageX),i=c.abs(g[0].pageY-g[1].pageY),j=c.sqrt(h*h+i*i),k=j/e._zoom.spacing*e._zoom.startScale,k<e.options.zoomMin?k=e.options.zoomMin:k>e.options.zoomMax&&(k=e.options.zoomMax),l=k/e._zoom.startScale,e.x=c.round(e.originX-e.originX*l+e._scroll.endX),e.y=c.round(e.originY-e.originY*l+e._scroll.endY),e._zoom.scale=k,e._scrollTo(e.x,e.y),e._execEvent("zoom",g),void 0;break;case"touchend":case"touchcancel":case"mouseup":if("start"===e.status&&(e.instance=null,e.status="end"),"scroll"===e.status)return e._scroll.endX=e.x,e._scroll.endY=e.y,e.options.momentum?(m=!1,n=!1,e.duration=Date.now()-e.startTime,e.duration<300?(e._scroll.lockX||(e.speedX=e.distanceX/e.duration,e.timeX=c.abs(e.speedX/e.options.g),e.directionX=e.speedX<0?"-":"+",m=!0),e._scroll.lockY||(e.speedY=e.distanceY/e.duration,e.timeY=c.abs(e.speedY/e.options.g),e.directionY=e.speedY<0?"-":"+",n=!0),m||n?d(e._step.bind(e)):e._endAction()):e._endAction()):e._endAction(),void 0;if("zoom"===e.status)return e._zoom.scale>e.options.zoomMax?e._zoom.scale=e.options.zoomMax:e._zoom.scale<e.options.zoomMin&&(e._zoom.scale=e.options.zoomMin),e.refresh(),e.x>0?e._scroll.endX=e.x=0:e.x<e.maxScrollX&&(e._scroll.endX=e.x=e.maxScrollX),e.y>0?e._scroll.endY=e.y=0:e.y<e.maxScrollY&&(e._scroll.endY=e.y=e.maxScrollY),e.scrollTo(e.x,e.y,400),e.status="end",e._execEvent("zoomEnd",g),void 0;e.scrollTo(e.x,e.y)}}},"undefined"!=typeof module&&module.exports&&!k?module.exports=m:"function"!=typeof define||k?a.JRoll=m:define(function(){return m})}(window,document,Math);
